<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="../static/CSS/Style.css">
    <script src="https://js.stripe.com/v3/"></script>
</head>
<style>
    body {
        padding-top: 120px; /* Adjust this value to match your header's height */
    }

    #empty {
        text-align: center;
        margin-top: 15%;
        font-size: 1.2em; 
    }

    #itemContainer {
        border-style: solid;
        border-radius: 10px; 
        margin: 20px auto; /* Center the container */
        padding: 20px;
        width: 50%;  /* Adjust width as needed */
        box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2); /* Subtle shadow effect  */
    }

    #placeOrder, #clearCart {
    margin-left: 47%;   
    background-color: #4CAF50; 
    border: none;
    color: white;
    padding: 15px 30px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    border-radius: 8px;
    cursor: pointer; 
}

#clearCart {
    margin-top: 20px; /* Adds a 20px margin to the top of the "Clear Cart" button */
}


</style>
</head>
<body>
<header id="MainHeader" style="background-color: lightgrey;">
    <a href="Order"><button id="OrderButton" onclick="document.getElementById('MainContent').src='Order.html'">Order</button></a>
    <a href="/"><button id="InfoButton" onclick="document.getElementById('MainContent').src='Information.html'">Main</button></a>
    <a href="/"><img src="../static/KSU-3D.svg" alt="KSU-3D" id="LogoHeader"></a>
    <a href="Custom"><button id="CostumButton">Custom Order</button></a>
    <a href="Cart"><button id="CartButton" class="CartButtonPic"></button></a>
</header>
<h1 id="empty">Your cart is empty.</h1>
<div id="itemContainer" style="border-style: solid; border-radius: 10px; scale: 60%;"></div>
<a><button id="placeOrder">Place Order</button></a>
<a><button id="clearCart">Clear Cart</button></a>
<script>
    const stripe = Stripe('pk_test_TYooMQauvdEDq54NiTphI7jx'); 
    const itemContainer = document.getElementById('itemContainer');
    const emptyCartMessage = document.getElementById('empty');
    const placeOrderButton = document.getElementById('placeOrder');

    document.getElementById('clearCart').addEventListener('click', () => {
    document.cookie = 'cartItems=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;'; 
    location.reload(); // Refresh the page
    });

    // Helper function to retrieve cart items from cookie
    function getCartItems() {
        const cartCookie = document.cookie.split('; ')
                                          .find(row => row.startsWith('cartItems='))
                                          ?.split('=')[1];
        return cartCookie ? JSON.parse(decodeURIComponent(cartCookie)) : [];
    }

    // Function to display cart items
    function displayCartItems() {
        itemContainer.innerHTML = ''; // Reset 
        const cartItems = getCartItems();

        if (cartItems.length === 0) {
            emptyCartMessage.style.display = 'block';
        } else {
            emptyCartMessage.style.display = 'none';
            cartItems.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.style.border = '1px solid black';

                // Replace with actual product name or image if you have it 
                const productName = getProductDisplayName(item.productId);  
                itemDiv.textContent = `${productName} x${item.quantity}`;
                itemDiv.style.fontSize = '2em';

                itemContainer.appendChild(itemDiv);
            });
        }
    }

    // Replace with your actual product mapping
    function getProductDisplayName(productId) {
        switch (productId) {
            case 'bagclip':
                return 'Poseklemme';
            // Add more cases for other product IDs
            default:
                return productId; 
        }
    }

    // Stripe Checkout logic
    placeOrderButton.addEventListener('click', async () => {
    const cartItems = getCartItems();

    // Send cart data to your Flask endpoint
    const response = await fetch('/create-checkout-session', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ cartItems }),
    });

    const session = await response.json();

    // Redirect to Stripe Checkout
    const result = await stripe.redirectToCheckout({
        sessionId: session.id,
    });

    if (result.error) {
        console.error(result.error);
    }
});

    // Replace with actual price lookup/calculation logic
    function getProductPrice(productId) {
    if (productId === 'bagclip') {
        return 'price_1ONa5FGWsGvUS6uHDkNWWhXZ'; // Replace with your actual Stripe price ID
    } else {
        // Handle other products if you have them
        return 'price_123'; // Placeholder for other potential products
    }
}

    // Initial display
    displayCartItems(); 
</script>
</body>
</html>
